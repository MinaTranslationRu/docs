import Page from "@reason/pages/Docs";
export default Page({ title: "Snark Workers for Node Operators" });

## Введение

В то время как большинство протоколов имеют только одну основную группу нод-операторов (часто называемых майнерами, валидаторами или блок-продюсерами), у Mina есть вторая группа — **snark worker**.

Снарк-воркеры являются неотъемлемой частью здоровья сети Mina, потому что именно эти узлы отвечают за "снаркинг" - производство SNARK-доказательств, связанных с транзакциями в сети. Производя эти доказательства, снарк-воркеры помогают поддерживать компактность блокчейн Mina.

В этом документе мы вкратце расскажем о том, зачем нужны снарк-воркеры, как выстраиваются экономические стимулы, а также опишем операционные детали выполнения снарк-работы. Кликните на любой из вышеперечисленных разделов, который наиболее соответствует вашим интересам.

Примечание: этот документ в первую очередь ориентирован на операторов нод и не будет охватывать теорию zk-SNARK. Глубокое знание теории SNARK не требуется для прочтения этого раздела. Но вам будет полезно приблизительно знать, как работают SNARK и для чего они используются. Пожалуйста, обратите внимание на [этот учебник по SNARK] в первую очередь.(https://minaprotocol.com/blog/what-are-zk-snarks)

## Почему Снарк-воркеры?

Уникальным свойством Mina является компактный блокчейн. Каждый блок-продюсер, когда он предлагает сети новый блок, должен также включить в этот блок zk-SNARK. Это позволяет нодам отказываться от всех исторических данных, которые были завершены, сохраняя только SNARK. Если вы незнакомы с протоколом Mina, [это видео будет хорошим началом].(https://www.youtube.com/watch?v=eWVGATxEB6M).

Однако, блок-продюсерам Mina недостаточно только лишь создавать SNARK-доказательства блоков. Транзакции также должны cодержать снарки. Причина заключается в том, что сам блокчейн SNARK не делает каких-либо утверждений о валидности сделок, включенных в блок.

Например - допустим, текущий заголовок блокчейна имеет хэш состояния `a6f8792226...`, и мы получаем новый блок с хэшем `0ffdcf284f...` . Этот блок будет содержать все транзакции, которые блок-продюсер выбрал для включения в этот блок, а также связанные с ним метаданные. Мы также получим сопроводительный SNARK, подтверждающий правильность сообщения:

> "There exists a block with a state hash 0ffdcf284f which extends the blockchain
> with a previous best tip with state hash a6f8792226."

Обратите внимание, что в этом сообщении ничего не говорится о действительности сделок, включенных в новый блок. Если мы поверим этому SNARK и ничего больше не предпримем, нас может обмануть вредоносный блок-продюсер, посылающий этот блок. К счастью, у нас есть "сырой" блок, и мы можем проверить каждую сделку, чтобы убедиться, что она действительна. Но как насчет нод в сети, которые могут просто захотеть получить подтверждение без проверки каждого блока?

## Транзакции со SNARK

Чтобы гарантировать, что ноды могут работать на Mina без доверия, важно, чтобы каждая нода могла проверить состояние блокчейна без необходимости воспроизводить транзакции. Для того, чтобы это сработало, описанного выше блокчейна SNARK недостаточно. Нам необходимо знать, что транзакции также достоверны. Поскольку SNARK хороши именно для этого, то элементарным предложением может быть генерация SNARK для каждой транзакции по мере их поступления, а затем их объединение.

Однако генерация доказательств SNARK является дорогостоящей вычислительной процедурой - если бы нам приходилось вычислять SNARK последовательно для каждой транзакции, то пропускная способность была бы очень низкой, а время формирования блоков - стремительно возрастало бы. Более того, транзакции в реальных условиях поступают асинхронно, поэтому было бы очень сложно предсказать, когда будет выполняться следующий этап работы.

К счастью для нас, мы можем использовать два свойства SNARK:

1. доказательства могут быть объединены - два доказательства могут быть объединены, чтобы сформировать _merge proof_
2. объединения сочетаемы - доказательства слияния идентичны, независимо от порядка их объединения

<picture>
  <source media="(min-width:48rem)" srcset="/static/img/docsImages/Documents_FAQFork_Tablet 1.jpg"/>
  <source media="(min-width:90rem)" srcset="/static/img/docsImages/Documents_SNARKS_p3-01 1.jpg" />
  <img src="/static/img/docsImages/Documents_FAQFork_Mobile 1.jpg" alt="Snark Workers"></img>
</picture>

То, что эти два свойства по сути позволяют нам сделать -  это воспользоваться преимуществами параллелизма. Если доказательства могут быть объединены, и неважно, как они объединены, то доказательства SNARK могут быть сгенерированы параллельно. Какое бы доказательство не было получено первым, оно может быть объединено позже с доказательствами, находящимися в процессе генерации. Это можно представить как бинарное дерево, где нижняя строка (листья) состоит из доказательств отдельных транзакций, а каждая родительская строка - из набора соответствующих доказательств объединения. Мы можем объединить их до самого корня, что будет представлять собой обновление состояния, выполняемое путём внесения изменений во все транзакции.

Кроме того, поскольку доказательства SNARK не зависят друг от друга, и мы можем использовать параллелизм, это означает, что работу может выполнить кто угодно! Конечный результат - распределенный рабочий пул без прав доступа. Любой, у кого есть свободные вычислительные мощности, может присоединиться к сети в качестве снарк-воркеров, отслеживать транзакции, которые должны иметь SNARK, и вносить свой вклад в вычисления. И, конечно же, они будут вознаграждены за свою работу в месте, которое мы с любовью называем **snarketplace**.

Примечание: Чтобы узнать больше о том, как развивалась данная схема работы SNARK, настоятельно рекомендуется посмотреть это видео: [High Throughput with Slow Snarks](https://www.youtube.com/watch?v=NZmq1V-Te0E). Если Вас интересует функциональное программирование и детали состояния сканирования (древовидная структура, описанная выше), [в нашем блоге есть публикация](/blog/scanning-for-scans) , раскрывающая технические детали, или [видео](https://www.youtube.com/watch?v=ztH_Z5TCe9I) , если вы предпочитаете такой формат.

## Snarketplace

Главная движущая сила для понимания того, как работает SNARK - следующая: 

_Блок-продюсеры используют свое вознаграждение, чтобы купить снарк-работу у снарк-воркеров._

Не существует никакого протокола, регулирующего ценообразование SNARK, равно как и не существует никакого стандартного вознаграждения снарк-воркеров за производство SNARK. Стимулы являются исключительно одноранговыми и динамически формируются в открытом маркетплейсе, так же известном как snarketplace.

Вы можете спросить, зачем блок-продюсеру покупать SNARK? Справедливый вопрос! Причина в том, о чем мы говорили ранее. Для того, чтобы знать наверняка, что состояние заголовка блока Mina является достоверным, транзакции должны иметь SNARK. Но если мы будем продолжать добавлять больше транзакций без SNARK с одинаковой скоростью, то с течением времени мы накопим работу, которая никогда не будет закончена. Чтобы достичь стабильного состояния равновесия, нам нужно, чтобы работа обрабатывалась примерно с той же скоростью, с которой она добавляется.

Поскольку блок-продюсеры получают прибыль от включения транзакций в блок (посредством комиссий за транзакции), они отвечают за взаимозачет сделок, приобретая соответствующее количество выполненной снарк-работы, тем самым создавая на нее спрос. Однако их обязанностью является приобретение снарк-работы по самой низкой цене на snarletplace. С другой стороны, снарк-воркеры хотят максимизировать свою прибыль, и, при этом, иметь возможность продать свою снарк-работу. Эти две роли действуют как две стороны маркетплейса и со временем устанавливают равновесную рыночную цену на снарк-работу.

### Как происходит ценообразование на снарк-работу

Мы ожидаем, что snarkeplace будет динамически восстанавливать равновесие - например, следуя простым законам [спроса и предложения] (https://en.wikipedia.org/wiki/Supply_and_demand). Хотя каждая снарк-работа относится к разным транзакциям, рассматривая их в более широкой перспективе, можно сказать, что снарк-работа во многом является товаром (т.е. не имеет значения, кто из snark-работников произвел снарк-работу - это будет один и тот же продукт). Однако есть некоторые нюансы, и это может помочь иметь некоторые алгоритмы для стратегии ценообразования:

- если рыночная цена равна Х, то, скорее всего, снарк-работа будет эффективно продаваться по любой цене ниже Х (например, Х - 1), при условии, что это будет выгодно после вычета операционных расходов.
- блок-продюсеры мотивированы покупать больше единиц снарк-работы у одного и того же снарк-работника, потому что им придется включить в блок только одну транзакцию _fee transfer_.
  - В принципе, способ, посредством которого блок-продюсер оплачивает работу снарк-работника, заключается в специальном виде транзакции, называемом "fee transfer". Стимулом для блок-продюсера является минимизация количества комиссионных переводов, поскольку каждая из них представляет собой отдельную транзакцию, которую необходимо добавить в блок (и, следовательно, компенсировать большим количеством snark-работы). Таким образом, лучшим вариантом является покупка у одного и того же снарк-работника комплекта снарк-работы.
- некоторые снарк-работы будут более важны для завершения их перед другими работами, так как это освободит всю память дерева (смотрите видео выше для более подробной информации). Это стало возможным благодаря различным методам отбора работ. В настоящее время существует два метода, поддерживаемых нативно - последовательный и случайный. Ни один из них, однако, не использует преимущества динамичных рынков, что является той областью улучшения, для которой сообщество Mina может разрабатывать решения.

Поскольку все данные о SNARK и ценах являются общедоступными, есть несколько способов проверки snarketplace. Одним из примеров является [использование GraphQL API].(https://youtu.be/XQlfX-LnK_A), и другие опции, в том числе использование CLI, или прокат пользовательского решения, отслеживающего SNARK в SNARK-мэмпуле.

Оставайтесь с нами для более детального анализа динамики snarketplace. В ближайшее время мы также выпустим экономический вайтпепер, который предоставит больше информации по данному вопросу.

См. также: [FAQ о SNARK and снарк-работниках](/docs/faq#snarks-and-snark-workers)

import Page from "@reason/pages/Docs";
export default Page({ title: "Troubleshooting" });

# Поиск проблем 

Вот несколько распространенных проблем, с которыми вы можете столкнуться при установке daemon Mina. Если вы не можете найти свою проблему здесь, обратитесь за помощью в [Discord](https://bit.ly/MinaDiscord) или в [Github](https://github.com/MinaProtocol/mina/issues/new).

- [Общее](#general)
- [Синхронизация ноды](#syncing-a-node)
- [Работа в сети](#networking)
- [Аккаунты и транзакции](#accounts-and-transactions)
- [Блок-продюсер](#block-producer)
- [Снарк-воркер](#snark-worker)
- [Логгинг](#logging)

## Общее

### Сбой моей ноды происходит каждые несколько минут. 

Если краш ноды происходит быстро и часто, скорее всего, возникла проблема с конфигурацией, связанная с некорректными разрешениями для закрытого ключа, невозможностью обнаружить пиры из-за неправильной передачи файла peers.txt, неправильным введением пароля или определенных символов в пароле. Последние несколько строк логов должны содержать дополнительную информацию о проблеме. 

### Я закрыл свой SSH-терминал, и произошел сбой ноды. 

Если вы запустили daemon mina на переднем плане, то как только вы отключитесь от него, он также отключится (с сигналом SIGINT). Чтобы запустить процесс в фоновом режиме для того, чтобы вы смогли отключиться, используйте любую опцию: 

- Запустите daemon с `-background`. 
- Запуститесь, используя службу systemd (смотрите [документацию](/docs/using-mina/connecting#ubuntu-1804--debian-9-1)).
- Запуститесь с Docker (смотрите [документацию](/docs/using-mina/connecting#docker)). 
- Запустите daemon в терминальном мультиплексоре, таком как screen или [tmux](https://icohigh.gitbook.io/mina-node-testnet/english/setting-up-tmux), от которых вы сможете отключиться, чтобы процесс продолжился. 

Рекомендуется запуск с использованием службы/через Docker, так как они имеют преимущество в виде автоматического перезапуска в случае сбоя вашей ноды. 

### Какие разрешения требуются для директории ключей? 
 
Директория `keys` должна иметь 700 разрешений, а файл закрытого ключа – 600. Например, с помощью этих команд обновляются разрешения, когда директория ключей содержится в вашем домашнем каталоге, а ваш файл закрытого ключа называется `my-wallet`:

```
chmod 700 ~/keys
chmod 600 ~/keys/my-wallet
```

### Могу ли я запуститься на устройстве на базе Raspberry Pi / ARM? 

Нет. Поддерживается только x86-64, но не ARM.

### В моем пароле есть специальные символы, и выдает ошибку. 

Вам необходимо заключить пароль в кавычки, например, `"MY_PASSWORD"`, и/или замените специальные символы в пароле, такие как `$`, символом `\`. 

### Выдает ошибку разрешений при запуске команды docker. 

Добавьте текущего пользователя в группу docker, как указано в [этой статье](https://docs.docker.com/engine/install/linux-postinstall/). Вы можете добавить к команде префикс `sudo`, но этого не рекомендуется делать. 

### Я вижу monitor.ml.Error "Timed out getting connection from process" на macOS. 

Если вы запускаете Mina на macOS и видите следующую ошибку тайм-аута `monitor.ml.Error "Timed out getting connection from process"`, вам необходимо добавить свой hostname в `/etc/hosts`, выполнив следующую команду : 

- $ `hostname`, чтобы получить hostname
- Откройте файл `/etc/hosts` и добавьте маппинг: 

```
##
# Host Database
#
# localhost is used to configure the loopback interface
# when the system is booting.  Do not change this entry.
##
127.0.0.1       localhost
127.0.0.1       <ADD YOUR HOSTNAME HERE>
This is necessary because sometimes macOS doesn't resolve your hostname to your local IP address.
```

### Какое оборудование мне нужно? 

Смотрите требования для работы в текущей сети [здесь](https://minaprotocol.com/docs/getting-started). При использовании некоторых VPS-провайдеров более низкого уровня может возникнуть проблема при создании блоков во время слота. Если вы продолжаете сталкиваться с проблемой пропущенных блоков, вы можете попробовать использовать более мощное оборудование. 

### Я бы хотел, чтобы служба mina запускалась в момент загрузки. 

Если вы используете `systemd` для управления daemon Mina, он не будет автоматически перезагружаться при перезагрузке машины. Вы можете запустить службу вручную с помощью `systemctl --user enable mina` или запустить `systemctl --user enable mina`, чтобы служба автоматически запускалась при загрузке. 

### Что мне необходимо добавить для CODA_PRIVKEY_PASS?

Когда вы сгенерировали keypair, вы создали пароль. Используйте пароль, который вы создали, для значения `CODA_PRIVKEY_PASS`.

### Я получаю сообщение c ошибкой об отсутствии ~/.mina-config/daemon.json.

Этот файл необязательно использовать при передаче [параметров конфигурации](https://minaprotocol.com/docs/node-operator) daemon (вместо передачи с помощью командной строки). Daemon ищет его по умолчанию, что приводит к ошибке, если вы его не включите. Просто проигнорируйте эту ошибку (если вы не пытаетесь его включить), поскольку она не фатальна, и daemon запустится в нормальном режиме. 

### Я вижу сообщения о том, что доказывающий/проверяющий периодически убиваются.  

Это нормальный процесс, и в настоящее время они периодически завершаются и перезапускаются. Игнорируйте эти сообщения, если они не приводят к фатальной ошибке/сбою. 

### Произошел сбой, появилось сообщение: "Fatal error: out of memory". 

Это распространенная проблема - читайте об этой [проблеме](https://github.com/MinaProtocol/mina/issues/6851) на GitHub, добавьте всю необходимую информацию в логи и перезапустите ноду. 
 
### Могу ли я создать свой пароль с помощью переменной среды? 

Да. Задайте в качестве пароля переменную среды `CODA_PRIVKEY_PASS`.

### Пытаюсь совершить установку на Ubuntu 20.04 / Debian 10, и появляется ошибка зависимости.  

Смотрите это [руководство в Discord](https://discordapp.com/channels/484437221055922177/583400552487059546/822269019687354418), и вы сможете вручную решить проблему зависимостей. В качестве аналога используйте поддерживаемую ОС (Ubuntu 18.04/Debian 9) или Docker. 

## Синхронизация ноды

### Я застрял на высоте блока 1 и максимальной наблюдаемой длине блока 1. 

На выходе `mina client status` должно быть следующее:

```
Block height:                    1
Max observed block length:       1
```

Эта проблема была устранена в релизе `9652f8ee092ea77e29f5ab49fa0a295e36743e8b`, пожалуйста, убедитесь, что вы обновились. Во время инициализации daemon высота 1 - это нормально. Переход ноды к фазе catchup может занять какое-то время (от 20 минут до часа). 

### Моя "максимальная наблюдаемая длина блока" равна 1, верна ли высота моего блока? 

Эта проблема была устранена в релизе `9652f8ee092ea77e29f5ab49fa0a295e36743e8b`, пожалуйста, убедитесь, что вы обновились. После обновления убедитесь, что daemon запустился (занимает от 20 минут до часа), и ошибка исчезнет. 

### Моя нода застряла в фазе catchup / высота блока не обновляется. 

Когда нода синхронизирована, **высота блока** должна быть равна **максимальной наблюдаемой длине блока**, как показано в выходных данных `mina client status`, и должна соответствовать текущей высоте сети, как показано на снимке ниже: 

![Синхронизация ноды](https://i.imgur.com/iWJTYTr.png)

Во время запуска ноды, когда она еще находится в состоянии начальной загрузки/в фазе catchup, высота блока будет отображать 1 или число, которое составляет несколько сотен блоков от текущей лучшей длины блока (но намного больше 1). Во время catchup высота блока не будет постепенно обновляться, кроме случаев создания новых блоков, и переключится на правильную высоту после того, как фаза catchup завершится. Так что будьте терпеливы; этот процесс может занять несколько часов и зависит от используемого вами оборудования. 

### Я синхронизировался на высоте 1 / не на текущей высоте сети. 

Важно то, что ваша текущая длина блокчейна, как видно из `mina client status`, равна текущей высоте сети. Если ваша нода сообщает, что она синхронизировалась с неправильной высотой, она должна в конечном счете перейти в фазу catchup, чтобы занять правильную высоту. Вы можете время от времени переключаться между фазами catchup и synced, если в сети обнаруживаются небольшие форки, которые нода пытается "догнать". 

### Почему мой блокчейн подскакивает до 1000+, а затем застревает? 

Для создания блоков нам нужны только последние `k` (290) блоки блокчейна. Таким образом, после того, как бустрэп завершился, корень границы перехода (по сути, ваше локальное хранилище блоков) должен равняться текущей максимальной высоте минус `k` (290). Часть процесса синхронизации, которая требует значительного времени, а именно загрузка отсутствующих `k` блоков, выполняется **catchup**. Во время catchup вы не увидите увеличение высоты вашего блока (кроме новых блоков, созданных в сети), пока он не перейдет на текущую высоту и не будет синхронизирован. На это требуется время, так что не выключайте оборудование! 

### Мой статус синхронизации офлайн. 

Этот статус указывает на то, что вы не получали сообщений от пиров в течение последних ~24 минут. Убедитесь, что вы используете последнюю версию файла peers.txt. Вы можете добавить новые пиры к работающей ноде с помощью этой команды: 

```
cat peers.txt | xargs -I % mina advanced add-peers %
```

## Работа в сети

### My hosting provider is warning me: "Abuse message: Netscan detected"

There is some behavior with our p2p networking module that triggers this warning on some hosting providers (specifically we've heard this happening with Hetzner). To mitigate this configure your firewall to allow traffic from ssh, http, https and deny outgoing traffic to all private ip addresses.

Here is an example of this using the [ufw](https://help.ubuntu.com/community/UFW#UFW_-_Uncomplicated_Firewall) firewall tool. Thanks Ducca for sharing these rules and confirming they fix the issues on Hetzner.

Allow SSH, HTTP, HTTPS porst:

```
ufw allow 22
ufw allow 80
ufw allow 443
ufw enable
```

Block outgoing private connection:

```
ufw deny out from any to 10.0.0.0/8
ufw deny out from any to 172.16.0.0/12
ufw deny out from any to 192.168.0.0/16
ufw deny out from any to 100.64.0.0/10
ufw deny out from any to 198.18.0.0/15
ufw deny out from any to 169.254.0.0/16
```

See [#7053](https://github.com/MinaProtocol/mina/issues/7053) for more

### What ports need to be open?

The only port required to be open for the daemon to communicate with peers is TCP port `8302`.

The client port `8301` should **never** be exposed to the internet. There may be outdated references to other ports that were once used before but are no longer required.

### Node fails with "Failed to find any peers, crashing as this is not a seed node"?

First, ensure that you have downloaded the latest peers file from the email received - the URL does not change, but the list of peers is updated very frequently.

Next, depending on the method you use to start the node, ensure that you are passing the correct path to this file. For example, if using `systemd`, there must be a `peers.txt` file in your home directory.

This error should have been resolved by a recent update, so ensure you are on the latest release and have the latest peers file.

### I get an error couldn't determine our IP from the internet?

If you see `couldn't determine our IP from the internet, use -external-ip` flag, then the daemon failed to determine its own IP from [these service providers](https://github.com/MinaProtocol/mina/blob/056d0203722ddfec1c7ad216846434648cd7af5e/src/app/cli/src/find_ip.ml#L7-L11). Your firewall may be blocking HTTP/S requests, or you have a misconfigured network connection.

To bypass this, pass in the flag `-external-ip <your-ip-address>` when starting the Mina daemon. To get your external IP address, run `curl ifconfig.me`.

### Do I need to configure port forwarding manually?

The Mina node does its best to configure itself to be able to connect to the outside world without you needing to do any extra work. However, this may fail, depending on your router and network setup. In this case, you may have to manually forward the external-port.

A common cause of this is routers not supporting UPnP, a protocol that allows the node to configure the port forwarding automatically. If you experience this type of problem, find your router model and search for `<model> port forwarding` and follow the instructions to forward the ports from your router to your device running the Mina node. You'll need to open the TCP port `8302` by default.

Note: When running Mina in the cloud, you should instead configure security groups for your cloud provider.

### Do I need to allow "Accept incoming connections"

If you see one or more warnings like the below, then choose "Allow":

```
Do you want the application "mina" to accept incoming network connections?
```

## Accounts and Transactions

### What fee should I use to send a transaction / my transaction is stuck as pending?

Transactions that are included in blocks are prioritized by their transaction fees. If many transactions are pending, then the highest fee transactions will be included first. So, increasing your fees is the best way to ensure that your transaction is included. To view the transaction pool on a running node, you can use the following command (you will need to install `jq,` which is used to format the output of the following command, e.g., `sudo apt install jq`):

```
mina advanced pooled-user-commands | jq . | grep fee | sort | uniq -c | sort -n
      1     "fee": "0.031",
      5     "fee": "0.1",
```

If there are many transactions in the pool, you may need to increase your fee. For a visual overview of transaction fees, see [here](https://minaexplorer.com/mempool).

If you have a stuck transaction due to a low fee, you will have to wait for it to be included in a block or to be evicted from the transaction pool as there is currently no way to cancel a transaction due to this [known issue](https://github.com/MinaProtocol/mina/issues/6605).

### How many transactions can be included in a block?

On the current network, this is 128, which also includes the coinbase transaction as well as any fee transfers to pay snark workers.

### Can I cancel a transaction?

Not currently due to [this bug](https://github.com/MinaProtocol/mina/issues/6605).

### I sent a transaction, but it was never included in a block?

See [this answer](#what-fee-should-i-use-to-send-a-transaction--my-transaction-is-stuck-as-pending). The transaction was likely stuck as pending and then eventually evicted from the transaction pool. Try sending again.

### Why is the coinbase 0 / there are no transactions included in a block?

In certain circumstances, there is no snark work available to be purchased or is too expensive to be purchased. In this case, it may not be possible to include a coinbase transaction, and so there is no coinbase awarded for the block.

If transactions are not being included, the transaction fees likely do not cover the cost of the snark work required to be purchased to offset, including the transactions.

### Does the order of sending transactions matter?

Yes, transactions are processed in order according to the nonce associated with the transaction. So, if you send a transaction that is stuck, with, for example, a low fee, all following transactions will also be stuck regardless of the fees used in the later transactions. Unfortunately, there is no way to currently cancel a transaction due to a known issue, so you have to wait for either the transaction to be included or to be evicted from the transaction pool.

### Why does my account say "locked"?

If the output of `mina accounts list` shows your account is locked, this means that you need to unlock it using your private key password in order to use it to send transactions. To unlock, simply use the `mina accounts unlock --public-key` command.

A block producer does **not** need the account to be unlocked to produce blocks.

### I requested funds from the faucet, and they never arrived?

Check the status of the faucet [here](https://status.minaprotocol.com/) to see if there are any know issues with the faucet.

You can also check this [explorer](https://minaexplorer.com/wallet/B62qpVjcU3bxjWdVGiXd7tUGNag3cgjSNWmYuZTpU5Eg8MHPqnHfVeL) to see all pending transactions from the faucet to see if yours is listed or if there have been any recent faucet transactions.

If you have just started your node and are not synced, any balance sent from the faucet will not be displayed until the node is synced.

### What are time-locked accounts / why are some accounts timed and others untimed?

See the docs [here](https://minaprotocol.com/docs/architecture/timelock).

### Can I send a payment before I am synced?

Yes, but only if you have funds already in the ledger. If you requested funds from, e.g., the faucet or another community member, you will need to wait until you are synced so that you have a balance you can use to send.

### Error: Specified sender is not in the ledger or sent a transaction in transaction pool when sending a transaction

See [this answer](#can-I-send-a-payment-before-I-am-synced), you will need to wait until you are synced if you do not have an existing balance in the ledger.

### I am running a block producer, but I don't see anything in mina accounts list?

If you started the daemon passing the `block-producer-key` flag, then you still need to import the account to the daemon in order to send a transaction. To do so, use the `mina accounts import -priv-key` command, passing in the location of the private key file.

## Block producer

### How do I run a block producer?

The methods to start a node [in the documentation](/docs/using-mina/connecting) will run a block producer by default.

### How do I know if I am running a block producer

To check the status of your block producer, run `mina client status` and look for the lines **Block producers running**. You should see a value of 1 and also your public key.

![Running a block producer](https://i.imgur.com/IsXZcXN.png)

The line **Next block will be produced in** lets you know the next time you have won a slot to produce a block. If you have not won any further blocks in the epoch, a message "None this epoch..." will be displayed and will only update once a new epoch starts.

### How can I increase my chance of winning a block?

The chance of winning a block is determined by a Verifiable Random Function (VRF), with the chance of winning a block being proportional to your stake. The VRF will always return the same result no matter how many times it is run, so there is no way of improving your chance of winning a block. Other than your staking balance, it is down to luck.

The stake associated with your public key is determined in advance at the start of an epoch. There is a delay in it being considered, so receiving funds, block rewards, delegating other funds, and snark worker rewards will **not** improve your chance of winning a block in this epoch as these funds will not be considered in the staking ledger for at least another full epoch (~2 weeks).

### Why was my block orphaned / why did I not get a block reward?

There can be more than one block producer per slot due to the way block producers are selected. So if two (or more) blocks are produced for the same slot, it will cause a short fork, and only one will be chosen - the winner in this instance is random based on the VRF output for each block producer. If you consistently see orphaned blocks, then you may be producing blocks slowly, and so other block producers may not see your block before building atop the current longest chain.

It is also possible to produce a block in catchup, and this block will also be quickly orphaned as it is not building on the correct height.

### I didn't produce a block / I missed a slot?

There are a few reasons why you could miss a slot / not successfully produce a block, for example, the node restarting and being in bootstrap at the time of producing a slot.

Also, you must produce a block within the slot time (3 mins). If you are on less powerful hardware or the daemon is competing for resources, it may not produce the block in time. In this instance, you should find in your logs:

`Internally generated block $state_hash cannot be rebroadcast because it's not a valid time to do so ($timing)`

It is not recommended to run a snark worker on the same machine at the same time you are producing a block as the snark worker is resource-intensive and may lead to the block not being produced in time. You can disable the snark worker during block production by, for example, using the [snark stopper script](https://github.com/c29r3/mina-snark-stopper).

### Why is the block rate so low / how often should there be a block?

A slot on the current network is every 3 mins, though not all slots should have a block produced, so on average, we would expect a block every 4 mins. However, not all the stake is online and active in producing blocks, and so not all slots will have a block, and sometimes there can be long delays between blocks. As more of the stake is online and staking, this situation improves.

### Why does O(1) Labs win most of the blocks?

To keep the network stable, O(1) Labs has 30% of the stake, so has a much greater probability of winning a slot and producing a block. Users who were given a balance of 66,000 mina have about a 0.1% chance of winning any particular slot, so should expect a block every couple of days, but luck plays a major factor in how often you will win a block.

### How do I know if I won a block or a transaction went through?

The easiest way is to check a [block explorer](https://minaexplorer.com/). You can also get this information for recent blocks via the [GraphQL API](https://minaprotocol.com/docs/developers/graphql-api).

### Why do I have a message of "No blocks won this this epoch"?

See [this answer](#how-can-I-increase-my-chance-of-winning-a-block).

## Snark worker

### My snark work is not getting bought / what fee should I use for a snark worker?

If you are running a snark worker and not seeing any work being included in blocks, then likely others are producing cheaper snark work. Multiple snark workers are all competing for the same snark work, with only the lowest fee for each being included in the snark pool to be bought by block producers.

Sometimes high fees will be included in blocks, and this is a function of how snark workers select which work to complete and which work is required to be purchased by the block producer.

By default, the work selection for a snark worker is random. You can change this by adding the `-work-selection seq` flag to the `mina daemon` command, which will work on jobs in the order required to be included from the scan state and will likely result in your snarks being included without a potentially lengthy delay.

For choosing fees, you can look at historical blocks to determine prices that have been bought, or look at the table listed [here](https://minaexplorer.com/snark-challenge).

### How can I disable the snark worker?

Запустите `mina client set-snark-worker`, чтобы отключить снарк-воркер. Чтобы его снова подключить, передайте свой открытый ключ `mina client set-snark-worker -address <YOUR_PUBLIC_KEY>`.

### Могу ли я запустить снарк-воркера и блок-продюсера на одной машине? 

Да, но вы должны остановить работу снарк-воркера во время производства блоков, чтобы не конкурировать за ресурсы и не пропустить создание блока. Снарк-воркеры также в целом потребляют больше ресурсов. Смотрите [сценарий остановки snark](https://github.com/c29r3/mina-snark-stopper), чтобы оказать помощь в автоматизации.

## Логгинг

### Я вижу в логах странные сообщения/ошибки.

Логи могут быть броскими и часто содержат "пугающие" сообщения, такие как сбой подключения и другое. Как правило, если сообщение не является фатальным, и нода не завершает аварийную работу, то, вероятно, вам не о чем беспокоиться. Все сообщения ниже считаются "нормальными": 

```
"RPC #841 failed: \"internal RPC error error: unknown stream_idx\""
"Peer $peer didn't have enough information to answer ledger_hash query. See error for more details: $error"
"Timed out waiting for the parent of $cached_transition after 0 ms, signalling a catchup job"
"Failed to reset stream (this means it was probably closed successfully): $error
        error: {
  "string":
    "RPC #365 failed: \"internal RPC error error: unknown stream_idx\""
}
```

### Как мне получить логи при запуске с помощью службы?

`journalctl --user -u mina -n 1000 -f`

### Как мне получить логи при запуске Docker? 

`docker logs --follow mina`

### Как мне получить логи при запуске daemon вручную? 

`tail -f ~/.mina-config/mina.log`

### Сколько хранится логов / где находятся логи? 

Логи Mina находятся в директории `~/.mina-config`. Эта директория содержит следующее:

- `mina.log` - Этот файл содержит последние логи работы daemon. Каждый лог имеет ограниченный размер 10 МБ и вращается через 50 логов. Вращающиеся логи называются `mina.log.x` от `mina.log.0` до `mina.log.50`.
- `mina-best-tip.log` - используется для записи логов best tip, чтобы упростить сбор необходимых логов с нод для определения состояния хардфорка. Размер каждого файла имеет ограничение до 5 MiB и вращается не более чем через 5 файлов от ` mina-best-tip.log.0` до `mina-best-tip.log.5`.
- `mina-prover.log` - регистрирует использование памяти и размер партии прувера; его размер имеет ограничение в 128 MiB, и он вращается с помощью одного лог-файла. 
- `mina-verifier.log` - регистрирует использование памяти и размер партии верификатора, ограничен до 128 MiB и вращается через один лог-файл. 
- `mina.version` - Этот файл содержит Git SHA работающего daemon. 
